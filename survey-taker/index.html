<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey App</title>
    <style>
        /* CAPTRS Design System */
        :root {
            /* Colors */
            --color-primary-darkest: #181a43;
            --color-primary-dark: #2b3d8b;
            --color-primary-medium: #4358a3;
            --color-white: #ffffff;
            --color-black: #000000;
            --color-light-gray: #eef0f8;
            --color-gray-100: #f8f9fa;
            --color-gray-200: #e9ecef;
            --color-gray-300: #dee2e6;
            --color-gray-400: #ced4da;
            --color-gray-500: #adb5bd;
            --color-gray-600: #6c757d;
            --color-gray-700: #495057;
            --color-gray-800: #343a40;
            --color-gray-900: #212529;
            --color-success: #28a745;
            --color-warning: #ffc107;
            --color-error: #dc3545;
            --color-info: #17a2b8;

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            --space-32: 8rem;

            /* Typography */
            --font-family-headline: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-family-body: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;

            /* Border Radius */
            --radius-sm: 0.125rem;
            --radius-base: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* Z-Index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;

            /* Layout */
            --header-height: 64px;
            --footer-height: 80px;
            --container-max-width: 1200px;
            --container-padding: 1rem;
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-left: env(safe-area-inset-left, 0px);

            /* Dynamic positioning variables */
            --calculated-header-height: 64px;
            --calculated-section-title-height: 80px;
            --calculated-question-progress-height: 60px;
            --calculated-total-fixed-height: 204px;
        }

        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
        }

        html {
            font-family: var(--font-family-body);
            line-height: var(--line-height-normal);
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            margin: 0;
            padding: 0;
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            color: var(--color-gray-900);
            background-color: var(--color-light-gray);
            min-height: 100vh;
        }
        /* Survey App Container */
        .survey-app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--color-light-gray);
        }

        /* Fixed Header */
        .survey-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, var(--color-primary-darkest) 0%, var(--color-primary-medium) 100%);
            color: var(--color-white);
            z-index: var(--z-fixed);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            padding: 0 var(--container-padding);
        }

        .header-content {
            width: 100%;
            max-width: var(--container-max-width);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .brand-logo {
            width: 32px;
            height: 32px;
            background-color: var(--color-white);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-dark);
            font-size: var(--font-size-lg);
        }

        .brand-title {
            font-family: var(--font-family-headline);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin: 0;
        }

        .header-progress {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .progress-step {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            transition: all 0.2s ease;
        }

        .progress-step.active {
            background-color: var(--color-white);
            color: var(--color-primary-dark);
        }

        .progress-step.completed {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .progress-connector {
            width: 20px;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .header-actions {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-lg);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .user-avatar:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* Section Title Container */
        .section-title-container {
            position: fixed;
            top: calc(var(--safe-area-top) + var(--header-height));
            left: 50%;
            transform: translateX(-50%);
            width: var(--container-max-width);
            max-width: 100vw;
            z-index: var(--z-sticky);
            background-color: var(--color-white);
            padding: var(--space-4) var(--container-padding);
            border-bottom: 1px solid var(--color-gray-200);
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .fixed-section-title {
            font-family: var(--font-family-headline);
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-gray-900);
            margin: 0 0 var(--space-2) 0;
            line-height: var(--line-height-tight);
        }

        .fixed-section-description {
            font-size: var(--font-size-base);
            color: var(--color-gray-600);
            margin: 0;
            line-height: var(--line-height-relaxed);
        }

        /* Question Progress Container */
        .question-progress-container {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            width: var(--container-max-width);
            max-width: 100vw;
            z-index: var(--z-sticky);
            background-color: var(--color-white);
            padding: var(--space-4) var(--container-padding);
            border-bottom: 1px solid var(--color-gray-200);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--color-gray-200);
            /* top is set dynamically by JavaScript */
        }

        .question-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }

        .question-progress-text {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .question-progress-count {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-gray-600);
        }

        .question-progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--color-gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .question-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary-medium) 0%, var(--color-primary-dark) 100%);
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
            position: relative;
        }

        .question-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Questions Container */
        .questions-container {
            flex: 1;
            padding: var(--space-4) var(--container-padding);
            max-width: var(--container-max-width);
            margin: 0 auto;
            width: 100%;
            /* padding-top is set dynamically by JavaScript */
        }

        .questions-container.no-progress {
            padding-top: calc(var(--calculated-header-height) + var(--calculated-section-title-height) + var(--space-4));
        }
        /* Questions Section */
        .questions-section {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-base);
            overflow: hidden;
        }

        /* Question Cards */
        .question-card {
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-gray-200);
        }

        .question-card:last-child {
            border-bottom: none;
        }

        .question-header {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .question-number {
            width: 32px;
            height: 32px;
            background-color: var(--color-primary-medium);
            color: var(--color-white);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            flex-shrink: 0;
        }

        .question-content {
            flex: 1;
        }

        .question-text {
            font-family: var(--font-family-headline);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-gray-900);
            margin: 0 0 var(--space-2) 0;
            line-height: var(--line-height-tight);
        }

        .question-required {
            color: var(--color-error);
            margin-left: var(--space-1);
        }

        .question-description {
            font-size: var(--font-size-sm);
            color: var(--color-gray-600);
            margin-top: var(--space-2);
            line-height: var(--line-height-relaxed);
        }

        /* Form Controls */
        .form-control {
            margin-top: var(--space-4);
        }

        .text-input {
            width: 100%;
            min-height: 120px;
            padding: var(--space-3);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-family-body);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            resize: vertical;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--color-primary-medium);
            box-shadow: 0 0 0 3px rgba(67, 88, 163, 0.1);
        }

        .text-input::placeholder {
            color: var(--color-gray-500);
        }

        /* Option Groups */
        .option-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .option-group--grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
        }

        .option-group--horizontal {
            flex-direction: row;
            flex-wrap: wrap;
        }

        .option-group--stack {
            gap: var(--space-2);
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background-color: var(--color-white);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .option-item:hover {
            border-color: var(--color-primary-medium);
            background-color: var(--color-gray-100);
        }

        .option-item.selected {
            border-color: var(--color-primary-medium);
            background-color: var(--color-primary-medium);
            color: var(--color-white);
        }

        .option-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .option-label {
            font-weight: var(--font-weight-medium);
            cursor: pointer;
        }

        /* Likert Scale */
        .likert-scale {
            margin-top: var(--space-4);
        }

        .likert-options {
            display: flex;
            justify-content: space-between;
            gap: var(--space-2);
        }

        .likert-option {
            flex: 1;
            text-align: center;
            padding: var(--space-3);
            border: 2px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background-color: var(--color-white);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .likert-option:hover {
            border-color: var(--color-primary-medium);
            background-color: var(--color-gray-100);
        }

        .likert-option.selected {
            border-color: var(--color-primary-medium);
            background-color: var(--color-primary-medium);
            color: var(--color-white);
        }

        .likert-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .likert-label {
            display: block;
            text-align: center;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .star-item {
            font-size: var(--font-size-2xl);
            color: var(--color-gray-300);
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .star-item:hover,
        .star-item.highlighted {
            color: var(--color-warning);
        }

        .star-item.selected {
            color: var(--color-warning);
        }

        .star-item.disabled {
            cursor: not-allowed;
        }
        /* Buttons */
        .button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-family-body);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .button--primary {
            background-color: var(--color-primary-medium);
            color: var(--color-white);
        }

        .button--primary:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .button--secondary {
            background-color: var(--color-gray-200);
            color: var(--color-gray-700);
        }

        .button--secondary:hover {
            background-color: var(--color-gray-300);
        }

        .button--lg {
            padding: var(--space-4) var(--space-8);
            font-size: var(--font-size-lg);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button--loading {
            color: transparent;
        }

        .button--loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Fixed Footer */
        .survey-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--footer-height);
            background-color: var(--color-white);
            border-top: 1px solid var(--color-gray-200);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--container-padding);
        }

        .footer-section {
            display: flex;
            align-items: center;
        }

        .footer-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-icon {
            font-size: var(--font-size-xl);
            color: var(--color-gray-500);
        }

        /* Spacers */
        .fixed-header-spacer {
            height: calc(var(--header-height) + var(--safe-area-top));
        }

        .fixed-footer-spacer {
            height: var(--footer-height);
        }
        .welcome-screen, .thank-you-screen {
            text-align: center;
            padding: 80px 40px;
            max-width: 700px;
            margin: 0 auto;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .welcome-screen::before, .thank-you-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #1976d2 0%, #1565c0 100%);
            border-radius: 20px 20px 0 0;
        }
        .welcome-screen .survey-title, .thank-you-screen .survey-title {
            font-size: 36px;
            font-weight: 700;
            color: #1976d2;
            margin-bottom: 32px;
            letter-spacing: -0.5px;
        }
        .welcome-message, .thank-you-message {
            font-size: 20px;
            line-height: 1.7;
            color: #4a5568;
            margin: 32px 0;
            font-weight: 300;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .branding {
            margin-top: 32px;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 12px;
            color: #999;
        }
        .company-name {
            font-weight: bold;
            color: #1976d2;
        }
        .powered-by {
            margin-top: 4px;
            font-style: italic;
        }
        .error-message {
            padding: 24px;
            margin: 24px;
            background-color: #ffebee;
            color: #c62828;
            border-radius: 8px;
            border: 1px solid #ffcdd2;
            text-align: center;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            font-size: 18px;
            color: #666;
        }
        .mode-indicator {
            position: fixed;
            top: 16px;
            right: 16px;
            background-color: #1976d2;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18';
        
        // SPA API Provider - Platform Integration
        class ApiProvider {
            constructor() {
                this.gameConfig = null;
                this.gameData = null;
                this.isReady = false;
                this.listeners = [];
                this.setupMessageListener();
            }

            setupMessageListener() {
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'CONFIG') {
                        this.handleConfigMessage(event.data);
                    }
                });
            }

            handleConfigMessage(data) {
                // Extract platform configuration
                const { token, url, exerciseId, appInstanceId, survey, surveyConfig } = data;
                
                // First, check if survey data is directly in the CONFIG message
                if (survey && this.isValidSurvey(survey)) {
                    this.gameConfig = survey;
                    this.isReady = true;
                    this.notifyListeners();
                    return;
                }
                
                if (surveyConfig && this.isValidSurvey(surveyConfig)) {
                    this.gameConfig = surveyConfig;
                    this.isReady = true;
                    this.notifyListeners();
                    return;
                }
                
                // Validate required parameters for API call
                if (!url || !token) {
                    this.useFallbackSurvey();
                    return;
                }
                
                // Use spa-api-provider pattern: getCurrentGameConfig
                this.fetchGameConfig(url, token, exerciseId, appInstanceId);
            }

            async fetchGameConfig(platformUrl, token, exerciseId, appInstanceId) {
                try {
                    // Use the same API call as spa-api-provider: getCurrentGameConfig
                    // This uses GET /api/gameConfig instead of POST /api/gameStartingData
                    const response = await fetch(`${platformUrl}/api/gameConfig`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const gameStartingData = await response.json();

                    // Extract survey configuration from game data
                    const surveyConfig = this.extractSurveyConfig(gameStartingData);
                    
                    if (surveyConfig) {
                        this.gameConfig = surveyConfig;
                        this.isReady = true;
                        this.notifyListeners();
                    } else {
                        this.useFallbackSurvey();
                    }
                } catch (error) {
                    this.useFallbackSurvey();
                }
            }

            useFallbackSurvey() {
                this.gameConfig = this.getSampleSurvey();
                this.isReady = true;
                this.notifyListeners();
            }

            extractSurveyConfig(gameStartingData) {
                // Look for survey configuration in various possible locations
                const possiblePaths = [
                    'surveyConfig',
                    'gameConfig.surveyConfig',
                    'appConfig.surveyConfig',
                    'configuration.surveyConfig',
                    'data.surveyConfig',
                    'survey',
                    'gameConfig.survey',
                    'appConfig.survey',
                    'configuration.survey',
                    'data.survey',
                    'gameConfig',
                    'appConfig',
                    'configuration',
                    'data',
                    'config',
                    'appData',
                    'gameData'
                ];

                for (const path of possiblePaths) {
                    const value = this.getNestedValue(gameStartingData, path);
                    
                    if (value && typeof value === 'object') {
                        // Check if this object looks like a survey
                        if (this.isValidSurvey(value)) {
                            return value;
                        }
                    }
                }

                // If no survey config found, check if the entire gameStartingData is a survey
                if (this.isValidSurvey(gameStartingData)) {
                    return gameStartingData;
                }

                return null;
            }

            isValidSurvey(obj) {
                // Check if an object has the structure of a valid survey
                if (!obj || typeof obj !== 'object') {
                    return false;
                }

                // Must have either questions array or be a survey-like structure
                const hasQuestions = obj.questions && Array.isArray(obj.questions) && obj.questions.length > 0;
                const hasSurveyStructure = obj.id && obj.title && (obj.questions || obj.welcome || obj.thankYou);
                
                console.log('🔍 Survey validation:', {
                    hasQuestions,
                    hasSurveyStructure,
                    id: obj.id,
                    title: obj.title,
                    questionsCount: obj.questions ? obj.questions.length : 0,
                    hasWelcome: !!obj.welcome,
                    hasThankYou: !!obj.thankYou
                });

                const isValid = hasQuestions || hasSurveyStructure;
                console.log(`✅ Survey validation result: ${isValid}`);
                return isValid;
            }

            getNestedValue(obj, path) {
                return path.split('.').reduce((current, key) => {
                    return current && current[key] !== undefined ? current[key] : null;
                }, obj);
            }

            getSampleSurvey() {
                return {
                    "id": "sample-survey-001",
                    "title": "CAPTRS Employee Satisfaction Survey",
                    "description": "Please take a moment to provide feedback about your work experience.",
                    "welcome": {
                        "title": "Welcome to Our Survey",
                        "message": "Your feedback is valuable to us. This survey will take approximately 5-10 minutes to complete. All responses are confidential."
                    },
                    "thankYou": {
                        "title": "Thank You!",
                        "message": "Your responses have been recorded successfully. Thank you for taking the time to provide your valuable feedback."
                    },
                    "settings": {
                        "branding": {
                            "companyName": "CAPTRS",
                            "poweredBy": "Powered by CAPTRS Survey Platform"
                        }
                    },
                    "sections": [
                        {
                            "id": "work-satisfaction",
                            "title": "Work Satisfaction",
                            "description": "Tell us about your satisfaction with your current role and work environment.",
                            "questions": [
                                {
                                    "id": "q1",
                                    "type": "radio",
                                    "question": "How satisfied are you with your current role?",
                                    "options": ["Very Satisfied", "Satisfied", "Neutral", "Dissatisfied", "Very Dissatisfied"],
                                    "required": true
                                },
                                {
                                    "id": "q2",
                                    "type": "yesno",
                                    "question": "Do you feel your work is meaningful and impactful?",
                                    "required": true
                                },
                                {
                                    "id": "q3",
                                    "type": "rating",
                                    "question": "Rate your overall job satisfaction (1-5 stars):",
                                    "required": true
                                },
                                {
                                    "id": "q4",
                                    "type": "text",
                                    "question": "What aspects of your job do you find most rewarding?",
                                    "description": "Please be specific in your response.",
                                    "required": false
                                }
                            ]
                        },
                        {
                            "id": "company-culture",
                            "title": "Company Culture & Environment",
                            "description": "Share your thoughts about our company culture and work environment.",
                            "questions": [
                                {
                                    "id": "q5",
                                    "type": "checkbox",
                                    "question": "Which benefits do you value most? (Select all that apply)",
                                    "options": [
                                        "Health Insurance",
                                        "Flexible Work Hours",
                                        "Remote Work Options",
                                        "Professional Development",
                                        "Team Building Events",
                                        "Performance Bonuses"
                                    ],
                                    "required": true
                                },
                                {
                                    "id": "q6",
                                    "type": "likert",
                                    "question": "I feel supported by my immediate supervisor.",
                                    "options": ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"],
                                    "required": true
                                },
                                {
                                    "id": "q7",
                                    "type": "likert",
                                    "question": "This company provides a supportive and inclusive work environment.",
                                    "options": ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"],
                                    "required": true
                                },
                                {
                                    "id": "q8",
                                    "type": "radio",
                                    "question": "Would you recommend this company as a great place to work?",
                                    "options": ["Definitely Yes", "Probably Yes", "Not Sure", "Probably No", "Definitely No"],
                                    "required": true
                                }
                            ]
                        }
                    ]
                };
            }

            subscribe(callback) {
                this.listeners.push(callback);
                if (this.isReady) {
                    callback(this.gameConfig);
                }
            }

            notifyListeners() {
                this.listeners.forEach(callback => callback(this.gameConfig));
            }

            getGameConfig() {
                return this.gameConfig;
            }

            isGameReady() {
                return this.isReady;
            }
        }

        // Create API provider instance
        const apiProvider = new ApiProvider();

        const SurveyApp = () => {
            const [survey, setSurvey] = React.useState(null);
            const [currentSectionIndex, setCurrentSectionIndex] = React.useState(-1); // Start at -1 for welcome screen
            const [answers, setAnswers] = React.useState({});
            const [isCompleted, setIsCompleted] = React.useState(false);
            const [appMode, setAppMode] = React.useState('loading');
            const [uploadedFileName, setUploadedFileName] = React.useState('');
            const [isSubmitting, setIsSubmitting] = React.useState(false);

            // Dynamic positioning hook for fixed elements
            const useDynamicPositioning = () => {
                const [dynamicStyles, setDynamicStyles] = React.useState({});

                React.useEffect(() => {
                    const updatePositions = () => {
                        const headerHeight = 64; // var(--header-height)
                        const sectionTitleContainer = document.querySelector('.section-title-container');
                        const questionProgressContainer = document.querySelector('.question-progress-container');
                        const questionsContainer = document.querySelector('.questions-container');

                        if (sectionTitleContainer && questionProgressContainer && questionsContainer) {
                            const sectionTitleHeight = sectionTitleContainer.offsetHeight;
                            const questionProgressTop = headerHeight + sectionTitleHeight;
                            const questionsPaddingTop = questionProgressTop + 60; // var(--question-progress-height)

                            setDynamicStyles({
                                questionProgressTop: `${questionProgressTop}px`,
                                questionsPaddingTop: `${questionsPaddingTop}px`
                            });
                        }
                    };

                    // Initial update
                    updatePositions();

                    // Set up observers for dynamic content changes
                    const resizeObserver = new ResizeObserver(updatePositions);
                    const mutationObserver = new MutationObserver(updatePositions);

                    const sectionTitleContainer = document.querySelector('.section-title-container');
                    if (sectionTitleContainer) {
                        resizeObserver.observe(sectionTitleContainer);
                        mutationObserver.observe(sectionTitleContainer, {
                            childList: true,
                            subtree: true,
                            characterData: true
                        });
                    }

                    // Update on window resize
                    window.addEventListener('resize', updatePositions);

                    return () => {
                        resizeObserver.disconnect();
                        mutationObserver.disconnect();
                        window.removeEventListener('resize', updatePositions);
                    };
                }, [currentSectionIndex]); // Re-run when section changes

                return dynamicStyles;
            };

            const dynamicStyles = useDynamicPositioning();

            // Initialize app with API provider
            React.useEffect(() => {
                // Check if running in iframe (platform mode)
                if (window.parent !== window) {
                    setAppMode('platform');
                    
                    // Subscribe to API provider updates
                    apiProvider.subscribe((surveyConfig) => {
                        console.log('Survey config received from API provider:', surveyConfig);
                        // Process survey to flatten sections if needed
                        const processedSurvey = processSurveyStructure(surveyConfig);
                        setSurvey(processedSurvey);
                    });

                    // Send ready message to platform
                    window.parent.postMessage({
                        type: 'SURVEY_APP_READY',
                        message: 'Survey app is ready to receive configuration'
                    }, '*');
                } else {
                    // Standalone mode - load sample survey
                    setAppMode('standalone');
                    const sampleSurvey = apiProvider.getSampleSurvey();
                    const processedSurvey = processSurveyStructure(sampleSurvey);
                    setSurvey(processedSurvey);
                }
            }, []);

            // Process survey structure to handle sections
            const processSurveyStructure = (surveyData) => {
                if (!surveyData) return null;
                
                // Keep the original structure with sections for the new layout
                if (surveyData.sections && Array.isArray(surveyData.sections)) {
                    return surveyData;
                }
                
                // If survey has a flat questions array, convert to sections format
                if (surveyData.questions && Array.isArray(surveyData.questions)) {
                    return {
                        ...surveyData,
                        sections: [{
                            id: 'main-section',
                            title: surveyData.title || 'Questions',
                            description: surveyData.description || '',
                            questions: surveyData.questions
                        }]
                    };
                }
                
                return surveyData;
            };

            const handleAnswerChange = (questionId, value) => {
                setAnswers(prev => ({ ...prev, [questionId]: value }));
            };

            const handleComplete = () => {
                setIsCompleted(true);
                
                // Send completion data to platform
                if (appMode === 'platform') {
                    window.parent.postMessage({
                        type: 'SURVEY_COMPLETE',
                        data: {
                            surveyId: survey.id,
                            answers,
                            timestamp: new Date().toISOString(),
                            sessionId: `session_${Date.now()}`
                        }
                    }, '*');
                }
                
                console.log('Survey completed:', { surveyId: survey.id, answers });
            };

            // Navigation helpers
            const canNavigateNext = React.useCallback(() => {
                const currentSection = survey?.sections?.[currentSectionIndex];
                if (!currentSection) return false;

                return currentSection.questions.every(q => {
                    const answer = answers[q.id];
                    return isValidAnswer(answer, q.type, q.required);
                });
            }, [survey, currentSectionIndex, answers]);

            const handleNext = React.useCallback(() => {
                if (currentSectionIndex < (survey?.sections?.length || 0) - 1) {
                    setCurrentSectionIndex(prev => prev + 1);
                } else {
                    handleComplete();
                }
            }, [currentSectionIndex, survey, handleComplete]);

            const handlePrevious = React.useCallback(() => {
                setCurrentSectionIndex(prev => Math.max(0, prev - 1));
            }, []);

            // Utility function for answer validation
            const isValidAnswer = (answer, type, required) => {
                if (!required) return true;
                if (answer === undefined || answer === null) return false;
                
                switch (type) {
                    case 'text':
                        return typeof answer === 'string' && answer.trim().length > 0;
                    case 'checkbox':
                        return Array.isArray(answer) && answer.length > 0;
                    case 'radio':
                    case 'likert':
                    case 'yesno':
                        return typeof answer === 'string' && answer.length > 0;
                    case 'rating':
                        return typeof answer === 'number' && answer > 0;
                    default:
                        return !!answer;
                }
            };

            // Question progress calculation for current section
            const questionProgress = React.useMemo(() => {
                const currentSection = survey?.sections?.[currentSectionIndex];
                if (!currentSection) return { current: 0, total: 0, percentage: 0 };

                const totalQuestions = currentSection.questions.length;
                const answeredQuestions = currentSection.questions.filter(q => {
                    const answer = answers[q.id];
                    // Check if question is actually answered (not just if it's valid)
                    if (answer === undefined || answer === null) return false;
                    
                    switch (q.type) {
                        case 'text':
                            return typeof answer === 'string' && answer.trim().length > 0;
                        case 'checkbox':
                            return Array.isArray(answer) && answer.length > 0;
                        case 'radio':
                        case 'likert':
                        case 'yesno':
                            return typeof answer === 'string' && answer.length > 0;
                        case 'rating':
                            return typeof answer === 'number' && answer > 0;
                        default:
                            return !!answer;
                    }
                }).length;

                return {
                    current: answeredQuestions,
                    total: totalQuestions,
                    percentage: totalQuestions > 0 ? Math.round((answeredQuestions / totalQuestions) * 100) : 0
                };
            }, [survey, currentSectionIndex, answers]);

            // Section progress for header
            const createSectionProgress = React.useCallback(() => {
                if (!survey?.sections) return [];

                const sections = [];
                
                // Welcome section
                if (survey.welcome) {
                    sections.push({
                        id: 'welcome',
                        label: 'W',
                        title: 'Welcome',
                        isWelcome: true
                    });
                }

                // Question sections
                survey.sections.forEach((section, index) => {
                    sections.push({
                        id: section.id,
                        label: (index + 1).toString(),
                        title: section.title,
                        sectionIndex: index
                    });
                });

                // Thank you section
                if (survey.thankYou) {
                    sections.push({
                        id: 'thank-you',
                        label: 'T',
                        title: 'Thank You',
                        isThankYou: true
                    });
                }

                return sections.map((section, index) => {
                    let status = 'pending';
                    
                    if (section.isWelcome && currentSectionIndex === -1) {
                        status = 'active';
                    } else if (section.isThankYou && isCompleted) {
                        status = 'active';
                    } else if (section.sectionIndex !== undefined) {
                        if (section.sectionIndex < currentSectionIndex) {
                            status = 'completed';
                        } else if (section.sectionIndex === currentSectionIndex) {
                            status = 'active';
                        }
                    }

                    return { ...section, status, index };
                });
            }, [survey, currentSectionIndex, isCompleted]);

            // Show loading
            if (!survey) {
                return React.createElement('div', { className: 'loading' }, 'Loading survey...');
            }

            // Show welcome screen
            if (survey.welcome && currentSectionIndex === -1) {
                return React.createElement('div', { className: 'survey-app' },
                    React.createElement('div', { className: 'mode-indicator' }, `Mode: ${appMode}`),
                    
                    // Header for welcome screen
                    React.createElement('header', { className: 'survey-header' },
                        React.createElement('div', { className: 'header-content' },
                            React.createElement('div', { className: 'header-brand' },
                                React.createElement('div', { className: 'brand-logo', 'aria-hidden': 'true' }, 'C'),
                                React.createElement('h1', { className: 'brand-title' }, 'CAPTRS Survey')
                            ),
                            React.createElement('div', { className: 'header-progress', 'aria-label': 'Survey progress' },
                                React.createElement('div', { className: 'progress-step active' }, 'W')
                            ),
                            React.createElement('div', { className: 'header-actions' },
                                React.createElement('div', { 
                                    className: 'user-avatar',
                                    title: 'User profile',
                                    'aria-label': 'User profile'
                                }, '👤')
                            )
                        )
                    ),
                    
                    // Welcome content
                    React.createElement('main', { 
                        className: 'questions-container',
                        style: { paddingTop: 'calc(var(--header-height) + var(--space-8))' }
                    },
                        React.createElement('div', { className: 'welcome-screen' },
                            React.createElement('h1', { className: 'survey-title' }, survey.welcome.title),
                            React.createElement('p', { className: 'welcome-message' }, survey.welcome.message),
                            React.createElement('button', {
                                onClick: () => setCurrentSectionIndex(0),
                                className: 'button button--primary button--lg',
                                style: { marginTop: 'var(--space-8)' }
                            }, 'Start Survey'),
                            survey.settings?.branding && React.createElement('div', { className: 'branding' },
                                survey.settings.branding.companyName && 
                                    React.createElement('div', { className: 'company-name' }, survey.settings.branding.companyName),
                                survey.settings.branding.poweredBy && 
                                    React.createElement('div', { className: 'powered-by' }, survey.settings.branding.poweredBy)
                            )
                        )
                    )
                );
            }

            // Show thank you screen
            if (survey.thankYou && isCompleted) {
                return React.createElement('div', { className: 'survey-app' },
                    React.createElement('div', { className: 'mode-indicator' }, `Mode: ${appMode}`),
                    
                    // Header for thank you screen
                    React.createElement('header', { className: 'survey-header' },
                        React.createElement('div', { className: 'header-content' },
                            React.createElement('div', { className: 'header-brand' },
                                React.createElement('div', { className: 'brand-logo', 'aria-hidden': 'true' }, 'C'),
                                React.createElement('h1', { className: 'brand-title' }, 'CAPTRS Survey')
                            ),
                            React.createElement('div', { className: 'header-progress', 'aria-label': 'Survey progress' },
                                React.createElement('div', { className: 'progress-step completed' }, 'W'),
                                React.createElement('div', { className: 'progress-connector' }),
                                React.createElement('div', { className: 'progress-step completed' }, '1'),
                                React.createElement('div', { className: 'progress-connector' }),
                                React.createElement('div', { className: 'progress-step completed' }, '2'),
                                React.createElement('div', { className: 'progress-connector' }),
                                React.createElement('div', { className: 'progress-step active' }, 'T')
                            ),
                            React.createElement('div', { className: 'header-actions' },
                                React.createElement('div', { 
                                    className: 'user-avatar',
                                    title: 'User profile',
                                    'aria-label': 'User profile'
                                }, '👤')
                            )
                        )
                    ),
                    
                    // Thank you content
                    React.createElement('main', { 
                        className: 'questions-container',
                        style: { paddingTop: 'calc(var(--header-height) + var(--space-8))' }
                    },
                        React.createElement('div', { className: 'thank-you-screen' },
                            React.createElement('h1', { className: 'survey-title' }, survey.thankYou.title),
                            React.createElement('p', { className: 'thank-you-message' }, survey.thankYou.message),
                            survey.settings?.branding && React.createElement('div', { className: 'branding' },
                                survey.settings.branding.companyName && 
                                    React.createElement('div', { className: 'company-name' }, survey.settings.branding.companyName),
                                survey.settings.branding.poweredBy && 
                                    React.createElement('div', { className: 'powered-by' }, survey.settings.branding.poweredBy)
                            )
                        )
                    )
                );
            }

            // Question Components
            const TextQuestion = ({ question, answer, onChange, disabled }) => {
                return React.createElement('div', { className: 'form-control' },
                    React.createElement('textarea', {
                        className: 'text-input',
                        value: answer || '',
                        onChange: (e) => onChange(question.id, e.target.value),
                        placeholder: 'Enter your answer...',
                        required: question.required,
                        disabled,
                        'aria-describedby': question.description ? `${question.id}-desc` : undefined
                    }),
                    question.description && React.createElement('div', {
                        id: `${question.id}-desc`,
                        className: 'question-description'
                    }, question.description)
                );
            };

            const RadioQuestion = ({ question, answer, onChange, disabled }) => {
                return React.createElement('div', { className: 'form-control' },
                    React.createElement('div', { 
                        className: 'option-group option-group--grid',
                        role: 'radiogroup',
                        'aria-labelledby': `${question.id}-label`
                    },
                        question.options?.map((option) =>
                            React.createElement('label', {
                                key: option,
                                className: `option-item ${answer === option ? 'selected' : ''} ${disabled ? 'disabled' : ''}`,
                                role: 'radio',
                                'aria-checked': answer === option,
                                tabIndex: disabled ? -1 : 0
                            },
                                React.createElement('input', {
                                    type: 'radio',
                                    name: question.id,
                                    value: option,
                                    checked: answer === option,
                                    onChange: (e) => onChange(question.id, e.target.value),
                                    required: question.required,
                                    disabled,
                                    className: 'option-input'
                                }),
                                React.createElement('span', { className: 'option-label' }, option)
                            )
                        )
                    )
                );
            };

            const LikertQuestion = ({ question, answer, onChange, disabled }) => {
                return React.createElement('div', { className: 'form-control' },
                    React.createElement('div', { className: 'likert-scale' },
                        React.createElement('div', { 
                            className: 'likert-options',
                            role: 'radiogroup',
                            'aria-labelledby': `${question.id}-label`
                        },
                            question.options?.map((option) =>
                                React.createElement('label', {
                                    key: option,
                                    className: `likert-option ${answer === option ? 'selected' : ''} ${disabled ? 'disabled' : ''}`,
                                    role: 'radio',
                                    'aria-checked': answer === option,
                                    tabIndex: disabled ? -1 : 0
                                },
                                    React.createElement('input', {
                                        type: 'radio',
                                        name: question.id,
                                        value: option,
                                        checked: answer === option,
                                        onChange: (e) => onChange(question.id, e.target.value),
                                        required: question.required,
                                        disabled,
                                        className: 'option-input'
                                    }),
                                    React.createElement('span', { className: 'likert-label' }, option)
                                )
                            )
                        )
                    )
                );
            };

            const YesNoQuestion = ({ question, answer, onChange, disabled }) => {
                const options = ['Yes', 'No'];
                
                return React.createElement('div', { className: 'form-control' },
                    React.createElement('div', { 
                        className: 'option-group option-group--horizontal',
                        role: 'radiogroup',
                        'aria-labelledby': `${question.id}-label`
                    },
                        options.map((option) =>
                            React.createElement('label', {
                                key: option,
                                className: `option-item ${answer === option ? 'selected' : ''} ${disabled ? 'disabled' : ''}`,
                                role: 'radio',
                                'aria-checked': answer === option,
                                tabIndex: disabled ? -1 : 0
                            },
                                React.createElement('input', {
                                    type: 'radio',
                                    name: question.id,
                                    value: option,
                                    checked: answer === option,
                                    onChange: (e) => onChange(question.id, e.target.value),
                                    required: question.required,
                                    disabled,
                                    className: 'option-input'
                                }),
                                React.createElement('span', { className: 'option-label' }, option)
                            )
                        )
                    )
                );
            };

            const RatingQuestion = ({ question, answer, onChange, disabled }) => {
                const [hoveredStar, setHoveredStar] = React.useState(0);
                const stars = 5;

                return React.createElement('div', { className: 'form-control' },
                    React.createElement('div', { 
                        className: 'star-rating',
                        role: 'radiogroup',
                        'aria-labelledby': `${question.id}-label`,
                        onMouseLeave: () => setHoveredStar(0)
                    },
                        Array.from({ length: stars }, (_, i) => {
                            const starValue = i + 1;
                            const isSelected = answer >= starValue;
                            const isHighlighted = hoveredStar >= starValue;
                            
                            return React.createElement('label', {
                                key: starValue,
                                className: `star-item ${isSelected ? 'selected' : ''} ${isHighlighted ? 'highlighted' : ''} ${disabled ? 'disabled' : ''}`,
                                onMouseEnter: () => !disabled && setHoveredStar(starValue),
                                role: 'radio',
                                'aria-checked': answer === starValue,
                                'aria-label': `${starValue} star${starValue !== 1 ? 's' : ''}`,
                                tabIndex: disabled ? -1 : 0
                            },
                                React.createElement('input', {
                                    type: 'radio',
                                    name: question.id,
                                    value: starValue,
                                    checked: answer === starValue,
                                    onChange: (e) => onChange(question.id, parseInt(e.target.value)),
                                    required: question.required,
                                    disabled,
                                    className: 'option-input'
                                }),
                                '★'
                            );
                        })
                    )
                );
            };

            const CheckboxQuestion = ({ question, answer, onChange, disabled }) => {
                const currentAnswers = Array.isArray(answer) ? answer : [];

                const handleChange = (value, checked) => {
                    const newAnswers = checked 
                        ? [...currentAnswers, value]
                        : currentAnswers.filter(v => v !== value);
                    onChange(question.id, newAnswers);
                };

                return React.createElement('div', { className: 'form-control' },
                    React.createElement('div', { 
                        className: 'option-group option-group--stack',
                        role: 'group',
                        'aria-labelledby': `${question.id}-label`
                    },
                        question.options?.map((option) => {
                            const isChecked = currentAnswers.includes(option);
                            return React.createElement('label', {
                                key: option,
                                className: `option-item ${isChecked ? 'selected' : ''} ${disabled ? 'disabled' : ''}`,
                                tabIndex: disabled ? -1 : 0
                            },
                                React.createElement('input', {
                                    type: 'checkbox',
                                    value: option,
                                    checked: isChecked,
                                    onChange: (e) => handleChange(option, e.target.checked),
                                    required: question.required && currentAnswers.length === 0,
                                    disabled,
                                    className: 'option-input'
                                }),
                                React.createElement('span', { className: 'option-label' }, option)
                            );
                        })
                    )
                );
            };

            // Question Renderer
            const QuestionRenderer = ({ question, answer, onChange, disabled = false }) => {
                const questionType = question.type || 'text';

                const questionProps = { question, answer, onChange, disabled };

                switch (questionType) {
                    case 'text':
                        return React.createElement(TextQuestion, questionProps);
                    case 'radio':
                        return React.createElement(RadioQuestion, questionProps);
                    case 'likert':
                        return React.createElement(LikertQuestion, questionProps);
                    case 'yesno':
                        return React.createElement(YesNoQuestion, questionProps);
                    case 'rating':
                        return React.createElement(RatingQuestion, questionProps);
                    case 'checkbox':
                        return React.createElement(CheckboxQuestion, questionProps);
                    default:
                        return React.createElement('div', { className: 'error-message' },
                            `Unsupported question type: ${questionType}`
                        );
                }
            };

            // Get current section
            const currentSection = survey.sections?.[currentSectionIndex];
            if (!currentSection) {
                return React.createElement('div', { className: 'error-message' },
                    'Section not found. Please check the survey configuration.'
                );
            }

            const isLastSection = currentSectionIndex === (survey.sections?.length || 0) - 1;
            const sectionProgress = createSectionProgress();

            // Main survey interface
            return React.createElement('div', { className: 'survey-app' },
                React.createElement('div', { className: 'mode-indicator' }, `Mode: ${appMode}`),
                
                // Header (fixed positioned)
                React.createElement('header', { 
                    className: 'survey-header'
                },
                    React.createElement('div', { className: 'header-content' },
                        React.createElement('div', { className: 'header-brand' },
                            React.createElement('div', { className: 'brand-logo', 'aria-hidden': 'true' }, 'C'),
                            React.createElement('h1', { className: 'brand-title' }, 'CAPTRS Survey')
                        ),
                        React.createElement('div', { className: 'header-progress', 'aria-label': 'Survey progress' },
                            sectionProgress.map((section, index) =>
                                React.createElement(React.Fragment, { key: section.id },
                                    React.createElement('div', {
                                        className: `progress-step ${section.status === 'active' ? 'active' : ''} ${section.status === 'completed' ? 'completed' : ''}`,
                                        title: section.title,
                                        'aria-label': `${section.title} - ${section.status}`
                                    }, section.label),
                                    index < sectionProgress.length - 1 && 
                                        React.createElement('div', { className: 'progress-connector', 'aria-hidden': 'true' })
                                )
                            )
                        ),
                        React.createElement('div', { className: 'header-actions' },
                            React.createElement('div', { 
                                className: 'user-avatar',
                                title: 'User profile',
                                'aria-label': 'User profile'
                            }, '👤')
                        )
                    )
                ),

                // Section Title Container (fixed positioned)
                React.createElement('div', { 
                    className: 'section-title-container'
                },
                    React.createElement('h2', { 
                        className: 'fixed-section-title',
                        id: 'section-title'
                    }, `${currentSectionIndex + 1}. ${currentSection.title}`),
                    currentSection.description && React.createElement('p', { 
                        className: 'fixed-section-description' 
                    }, currentSection.description)
                ),

                // Question Progress Bar (fixed positioned)
                currentSection.questions.length > 0 && React.createElement('div', { 
                    className: 'question-progress-container',
                    style: { top: dynamicStyles.questionProgressTop }
                },
                    React.createElement('div', { className: 'question-progress-header' },
                        React.createElement('div', { className: 'question-progress-text' },
                            'Section Progress'
                        ),
                        React.createElement('div', { className: 'question-progress-count' },
                            `Question ${questionProgress.current} of ${questionProgress.total}`
                        )
                    ),
                    React.createElement('div', { 
                        className: 'question-progress-bar',
                        role: 'progressbar',
                        'aria-valuenow': questionProgress.percentage,
                        'aria-valuemin': 0,
                        'aria-valuemax': 100,
                        'aria-label': `Section progress: ${questionProgress.percentage}%`
                    },
                        React.createElement('div', { 
                            className: 'question-progress-fill',
                            style: { width: `${questionProgress.percentage}%` }
                        })
                    )
                ),

                // Questions Container
                React.createElement('main', { 
                    className: `questions-container ${currentSection.questions.length === 0 ? 'no-progress' : ''}`,
                    style: { paddingTop: dynamicStyles.questionsPaddingTop }
                },
                    React.createElement('div', { className: 'questions-section' },
                        currentSection.questions.map((question, index) =>
                            React.createElement('div', { 
                                key: question.id, 
                                className: 'question-card'
                            },
                                React.createElement('div', { className: 'question-header' },
                                    React.createElement('div', { 
                                        className: 'question-number',
                                        'aria-hidden': 'true'
                                    }, index + 1),
                                    React.createElement('div', { className: 'question-content' },
                                        React.createElement('h3', { 
                                            className: 'question-text',
                                            id: `${question.id}-label`
                                        },
                                            question.question,
                                            question.required && React.createElement('span', { 
                                                className: 'question-required',
                                                'aria-label': 'required'
                                            }, '*')
                                        )
                                    )
                                ),
                                React.createElement(QuestionRenderer, {
                                    question,
                                    answer: answers[question.id],
                                    onChange: handleAnswerChange,
                                    disabled: isSubmitting
                                })
                            )
                        )
                    )
                ),

                // Footer (fixed positioned)
                React.createElement('footer', { className: 'survey-footer' },
                    React.createElement('div', { className: 'footer-section' },
                        React.createElement('button', {
                            onClick: handlePrevious,
                            disabled: currentSectionIndex === 0 || isSubmitting,
                            className: 'button button--secondary',
                            'aria-label': 'Go to previous section'
                        },
                            React.createElement('span', { 'aria-hidden': 'true' }, '←'),
                            'Back'
                        )
                    ),
                    React.createElement('div', { className: 'footer-center' },
                        React.createElement('div', { className: 'footer-icon', 'aria-hidden': 'true' }, '📄')
                    ),
                    React.createElement('div', { className: 'footer-section' },
                        React.createElement('button', {
                            onClick: isLastSection ? handleComplete : handleNext,
                            disabled: !canNavigateNext() || isSubmitting,
                            className: `button button--primary ${isSubmitting ? 'button--loading' : ''}`,
                            'aria-label': isLastSection ? 'Complete survey' : 'Go to next section'
                        },
                            isLastSection ? 'Complete Survey' : 'Next',
                            React.createElement('span', { 'aria-hidden': 'true' }, '→')
                        )
                    )
                )
            );
        };

        // Render the app
        ReactDOM.render(
            React.createElement(SurveyApp),
            document.getElementById('root')
        );
    </script>
</body>
</html> 